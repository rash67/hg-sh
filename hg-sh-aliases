if [[ -e '/etc/fbwhoami' ]]; then
    hgb='/home/srash/bin/hg'
else
    hgb='/Users/srash/bin/hg'
fi

function _h-nb() {
  if [[ $2 != "" ]]; then
    $hgb update $2
  fi

  $hgb bookmarks $1
}

function _h-repull() {
  bookmark=`hg bo | grep '*' | cut -f 3 -d' '`
	$hgb pull --rebase
	$hgb update $bookmark
}

function hg-alias() {
	local hg_alias=$1
	local hg_cmd=${2:-$hg_alias}
	install-hg-completion $hg_alias $hg_cmd
	alias $hg_alias="$hgb $hg_cmd"

	if [[ "$hg_alias" != "$hg_cmd" ]]; then
	  alias $hg_cmd="$hgb $hg_cmd"
	fi
}

# installs hg completion for a given command. assumes the _hg function performs completion
# the first argument is the command, the 2nd is which hg command to use for completion.
# eg: install-hg-completion rbc update makes "rbc <tab>" complete as if "hg update <tab>" were typed
install-hg-completion() {
  local cmd=$1
  local hg_cmd=$2

  function_name="_hg_complete_$cmd"

  eval "function ${function_name}() {
    COMP_WORDS=('hg' \"${hg_cmd}\" \${COMP_WORDS[@]:1} )
    ((COMP_CWORD+=1))
    let x=\$COMP_CWORD-1
    _hg \"hg\" \"\${COMP_WORDS[\$COMP_CWORD]}\" \"\${COMP_WORDS[\$x]}\"
  }
";
	complete -o bashdefault -o default -o nospace -F $function_name $cmd \
    || complete -o default -o nospace -F $function_name $cmd

}

hg_cmd_list=`hg help 2>&1 | sed -n -e '/enabled extensions/,$p' | egrep '^ \w+' | grep -v '\#'  |cut -f 2 -d' '`
#hg_cmd_list=`hg help 2>&1 | egrep '^ \w+' | grep -v '\#'  |cut -f 2 -d' '`

for i in $hg_cmd_list; do
  if [[ "$i" == "cat" ]]; then
    true
  else
    #echo hg-alias $i $i
    hg-alias $i $i
  fi
done


hg_sh_path=$1
hg_cmd_alias_file="$hg_sh_path/hg-cmd-aliases"
for i in `grep '=' $hg_cmd_alias_file | cut -f 1 -d=`; do
  #echo hg-alias $i $i
  hg-alias $i $i
done

#specific aliases that are different or that we want to induce tab-completion for
hg-alias au addremove
hg-alias bk bookmarks
hg-alias br bookmark
hg-alias br bookmarks
hg-alias ci commit
hg-alias co update
hg-alias ev evolve
hg-alias he histedit
hg-alias l lg
hg-alias log lg
hg-alias mg graft
hg-alias rb rebase
hg-alias rm remove
hg-alias rslv resolve
hg-alias s summary
hg-alias shl shelve
hg-alias st status
hg-alias uc uncommit
hg-alias us unshelve

# alias where the 'hg <cmd>' is the same as the alias name (explicilty list)
hg-alias add
hg-alias amend
hg-alias backout
hg-alias blame
hg-alias branch
hg-alias clean
hg-alias diff
hg-alias heads
hg-alias help
hg-alias incoming
hg-alias journal
hg-alias mv
hg-alias paths
hg-alias pull
hg-alias push
hg-alias restack
hg-alias revert
hg-alias rl
hg-alias rm
hg-alias show
hg-alias sl


install-hg-completion rbc update
install-hg-completion rebase-chain.pl update

alias h=$hgb
